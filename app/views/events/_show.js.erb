$(document).ready(function() {
  $('#main-event-image').click(function(){
    $('#main-event-image').toggleClass("event-image-big");
  });

  $('.slot-book').click(function(e){
    e.preventDefault();
    var clickedSlot = $(e.target);
    var popup = $('#custom-popup');
    var slotNumber = clickedSlot.data('slot');
    var contentsWas = clickedSlot.html();
    clickedSlot.html('<i class="fa fa-spin fa-spinner" />');

    $.ajax({
      type: "PUT",
      url: "/events/<%= @event.id %>/slots/" + slotNumber,
      success: function(data) {
        clickedSlot.removeClass('btn-timeslot btn-book slot-book');
        clickedSlot.addClass('btn-timeslot-booked btn-booked');
        if (data.status==='ok') {
          clickedSlot.html('<%= my_slot %>');
          clickedSlot.addClass('glowing');
          popup.removeClass('alert-warning').addClass('alert-info');
        } else {
          clickedSlot.html('<%= already_booked %>');
          popup.removeClass('alert-info').addClass('alert-warning');
        }
        $('#popup-content').html('<span>'+data.msg+'</span>');
        popup.addClass('alert').slideDown();
      },
      error: function(data) {
        if (data.status==401) {
          window.location.replace('<%= url_for(controller: "devise/sessions", action: "new") %>');
        } else {
          window.location.reload();
        }
      }
    });
  });
});
